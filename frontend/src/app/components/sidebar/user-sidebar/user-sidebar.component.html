<div class="flex flex-col h-[calc(100vh-64px)] bg-[#f8f9ff]">
  <div class="flex flex-grow items-left">
    <button
    *ngIf="isMobile"
    (click)="sidebarOpen = !sidebarOpen"
    class="absolute top-4 left-4 z-50 p-2 rounded bg-white shadow-md"
    aria-label="Ouvrir le menu"
  >
    <div class="flex items-center">
      <mat-icon>menu</mat-icon>
      <span class="ml-2 text-sm">Mon espace</span>
    </div>
  </button>

  <div class="flex flex-grow items-left">
    <aside
      [ngClass]="{
        'fixed inset-0 z-40 w-64 bg-[#f8f9ff] shadow-md border-r-2 border-[#e8edff] border-solid transition-transform duration-200': isMobile,
        'translate-x-0': sidebarOpen,
        '-translate-x-full': isMobile && !sidebarOpen,
        'p-6 shadow-md w-64 border-r-2 border-[#e8edff] border-solid': !isMobile
      }"
      *ngIf="!isMobile || sidebarOpen"
      (click)="isMobile ? sidebarOpen = false : null"
    >
      <div 
        [ngClass]="{
          'mb-6 mt-4': !isMobile,
          'mb-6 mt-8 p-6': isMobile
        }" 
        (click)="$event.stopPropagation()"
      >
        <nav aria-label="MySpace">
          <mat-nav-list class="space-y-4 p-0">
            <h3 
              *ngIf="!isMobile"
              mat-subheader class="text-lg font-semibold"
            >Mon espace</h3>

            <mat-list-item
              class="rounded cursor-pointer"
              (click)="toggleSection('ressources')"
              [ngClass]="{
                '!bg-[#e8edff]': isSectionActive('ressources')
              }"
            >
              <div class="flex items-center justify-between w-full">
                <div class="flex items-center">
                  <mat-icon>folder</mat-icon>
                  <span class="ml-2">Ressources</span>
                </div>
                <mat-icon class="text-sm">
                  {{
                    expandedSection === "ressources" ? "expand_less" : "expand_more"
                  }}
                </mat-icon>
              </div>
            </mat-list-item>

            <div
              *ngIf="expandedSection === 'ressources'"
              class="flex flex-col ml-8 space-y-1"
            >
              <mat-list-item
                class="rounded cursor-pointer"
                (click)="select('ressources.list')"
                [ngClass]="{
                  '!bg-[#e8edff]': isViewActive('ressources.list')
                }"
              >
                <div class="flex items-center">
                  <mat-icon class="text-sm">format_list_bulleted</mat-icon>
                  <span class="ml-2 text-sm">Mes créations</span>
                </div>
              </mat-list-item>
              <mat-list-item
                class="rounded cursor-pointer"
                (click)="select('ressources.save-list')"
                [ngClass]="{
                  '!bg-[#eef2ff]': isViewActive('ressources.save-list')
                }"
              >
                <div class="flex items-center">
                  <mat-icon class="text-sm">bookmark</mat-icon>
                  <span class="ml-2 text-sm">Sauvegardées</span>
                </div>
              </mat-list-item>
              <mat-list-item
                class="rounded cursor-pointer"
                (click)="select('ressources.create')"
                [ngClass]="{
                  '!bg-[#eef2ff]': isViewActive('ressources.create')
                }"
              >
                <div class="flex items-center">
                  <mat-icon class="text-sm">library_add</mat-icon>
                  <span class="ml-2 text-sm">Créer</span>
                </div>
              </mat-list-item>    
            </div>

            <mat-list-item
              class="rounded cursor-pointer"
              (click)="toggleSection('events')"
              [ngClass]="{
                '!bg-[#e8edff]': isSectionActive('events')
              }"
            >
              <div class="flex items-center justify-between w-full">
                <div class="flex items-center">
                  <mat-icon>event_note</mat-icon>
                  <span class="ml-2">Evènements</span>
                </div>
                <mat-icon class="text-sm">
                  {{
                    expandedSection === "events"
                      ? "expand_less"
                      : "expand_more"
                  }}
                </mat-icon>
              </div>
            </mat-list-item>

            <div
              *ngIf="expandedSection === 'events'"
              class="flex flex-col ml-8 space-y-1"
            >
              <mat-list-item
                class="rounded cursor-pointer"
                (click)="select('events.list')"
                [ngClass]="{
                  '!bg-[#eef2ff]': isViewActive('events.list')
                }"
              >
                <div class="flex items-center">
                  <mat-icon class="text-sm">event_available</mat-icon>
                  <span class="ml-2 text-sm">Mes évènements</span>
                </div>
              </mat-list-item>
              <mat-list-item
                class="rounded cursor-pointer"
                (click)="select('events.create')"
                [ngClass]="{
                  '!bg-[#eef2ff]': isViewActive('events.create')
                }"
              >
                <div class="flex items-center">
                  <mat-icon class="text-sm">label</mat-icon>
                  <span class="ml-2 text-sm">Créer</span>
                </div>
              </mat-list-item>
            </div>

            <mat-list-item
              class="rounded cursor-pointer"
              (click)="select('stats')"
              [ngClass]="{
                '!bg-[#e8edff]': isSectionActive('stats')
              }"
            >
              <div class="flex items-center">
                <mat-icon>bar_chart</mat-icon>
                <span class="ml-2">Statistiques</span>
              </div>
            </mat-list-item>

            <mat-list-item
              class="rounded cursor-pointer"
              (click)="onAdministrationClick()"
            >
              <div class="flex items-center">
                <mat-icon>manage_accounts</mat-icon>
                <span class="ml-2">Administration</span>
              </div>
            </mat-list-item>

            <mat-list-item
              *ngIf="isMobile"
              class="rounded cursor-pointer"
              (click)="select('profile')"
              [ngClass]="{
                '!bg-[#e8edff]': isSectionActive('profile')
              }"
            >
              <div class="flex items-center">
                <mat-icon>person</mat-icon>
                <span class="ml-2">Profil</span>
              </div>
            </mat-list-item>
          </mat-nav-list>
        </nav>
      </div>
    </aside>
    <!-- Overlay for mobile -->
    <div
      *ngIf="isMobile && sidebarOpen"
      class="fixed inset-0 bg-black bg-opacity-30 z-30"
      (click)="sidebarOpen = false"
    ></div>
  </div>
</div>
